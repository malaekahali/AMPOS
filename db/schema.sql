-- إنشاء جدول الموظفين
CREATE TABLE IF NOT EXISTS employees (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    employee_number TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL,
    role TEXT NOT NULL CHECK (role IN ('admin', 'cashier'))
);

-- إنشاء جدول المنتجات
CREATE TABLE IF NOT EXISTS products (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    price REAL NOT NULL,
    image_url TEXT,
    category TEXT NOT NULL,
    size TEXT DEFAULT 'وسط',
    sort_order INTEGER DEFAULT 0
);

-- إنشاء جدول الفواتير
CREATE TABLE IF NOT EXISTS invoices (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    employee_id INTEGER NOT NULL,
    date TEXT DEFAULT CURRENT_TIMESTAMP,
    total_amount REAL NOT NULL,
    payment_method TEXT NOT NULL CHECK (payment_method IN ('cash', 'card', 'mixed')),
    cash_amount REAL DEFAULT 0,
    card_amount REAL DEFAULT 0,
    payments TEXT, -- JSON array of payment objects: [{method: 'cash'|'card', amount: number}]
    daily_number INTEGER,
    FOREIGN KEY (employee_id) REFERENCES employees(id)
);

-- إنشاء جدول عداد الفواتير اليومية
CREATE TABLE IF NOT EXISTS daily_invoice_counters (
    date TEXT PRIMARY KEY,
    current_number INTEGER DEFAULT 0
);

-- إنشاء جدول إنهاء اليوم
CREATE TABLE IF NOT EXISTS daily_closures (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    date TEXT NOT NULL,
    total_sales REAL NOT NULL,
    total_tax REAL NOT NULL,
    net_sales REAL NOT NULL,
    total_invoices INTEGER NOT NULL,
    closed_by INTEGER NOT NULL,
    closed_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (closed_by) REFERENCES employees(id)
);

-- إنشاء جدول تفاصيل الفواتير
CREATE TABLE IF NOT EXISTS invoice_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    invoice_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL,
    price REAL NOT NULL,
    FOREIGN KEY (invoice_id) REFERENCES invoices(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);

-- إدراج بيانات تجريبية
INSERT OR IGNORE INTO employees (name, employee_number, password, role) VALUES
('المدير', '1234', '$2a$10$n41DwyEBNTjtPA91SLZX4OeMoYmtfGmpNSSfef5oShdRTmnFGRKRC', 'admin'), -- كلمة المرور: 1234512
('الموظف', '5678', '$2a$10$HqS2fJ1E2VJFPPylVbLZPO2gcNBag1XMa8iDYo2vxrA7Q7uLhcFLq', 'cashier'); -- كلمة المرور: 1234512

INSERT OR IGNORE INTO products (name, price, image_url, category, size, sort_order) VALUES
('إسبرسو', 10.00, '', 'مشروبات ساخنة', 'وسط', 1),
('دبل إسبرسو وسط', 12.00, '', 'مشروبات ساخنة', 'وسط', 2),
('دبل إسبرسو كبير', 14.00, '', 'مشروبات ساخنة', 'كبير', 3),
('أمريكانو وسط', 11.00, '', 'مشروبات ساخنة', 'وسط', 4),
('أمريكانو كبير', 13.00, '', 'مشروبات ساخنة', 'كبير', 5),
('كابتشينو وسط', 13.00, '', 'مشروبات ساخنة', 'وسط', 6),
('كابتشينو كبير', 15.00, '', 'مشروبات ساخنة', 'كبير', 7),
('لاتيه وسط', 14.00, '', 'مشروبات ساخنة', 'وسط', 8),
('لاتيه كبير', 16.00, '', 'مشروبات ساخنة', 'كبير', 9),
('فلات وايت', 15.00, '', 'مشروبات ساخنة', 'وسط', 10),
('موكا وسط', 16.00, '', 'مشروبات ساخنة', 'وسط', 11),
('موكا كبير', 18.00, '', 'مشروبات ساخنة', 'كبير', 12),
('كراميل ماكياتو وسط', 17.00, '', 'مشروبات ساخنة', 'وسط', 13),
('كراميل ماكياتو كبير', 19.00, '', 'مشروبات ساخنة', 'كبير', 14),
('سبانيش لاتيه وسط', 18.00, '', 'مشروبات ساخنة', 'وسط', 15),
('سبانيش لاتيه كبير', 20.00, '', 'مشروبات ساخنة', 'كبير', 16),
('قهوة تركية وسط', 12.00, '', 'مشروبات ساخنة', 'وسط', 17),
('قهوة تركية كبير', 14.00, '', 'مشروبات ساخنة', 'كبير', 18),
('قهوة فرنسية وسط', 13.00, '', 'مشروبات ساخنة', 'وسط', 19),
('قهوة فرنسية كبير', 15.00, '', 'مشروبات ساخنة', 'كبير', 20),
('قهوة عربية وسط', 11.00, '', 'مشروبات ساخنة', 'وسط', 21),
('قهوة عربية كبير', 13.00, '', 'مشروبات ساخنة', 'كبير', 22),
('شاي أخضر وسط', 10.00, '', 'مشروبات ساخنة', 'وسط', 23),
('شاي أخضر كبير', 12.00, '', 'مشروبات ساخنة', 'كبير', 24),
('عصير برتقال وسط', 13.00, '', 'عصائر', 'وسط', 1),
('عصير برتقال كبير', 15.00, '', 'عصائر', 'كبير', 2),
('آيس أمريكانو وسط', 12.00, '', 'مشروبات باردة', 'وسط', 3),
('آيس أمريكانو كبير', 14.00, '', 'مشروبات باردة', 'كبير', 4),
('آيس لاتيه وسط', 15.00, '', 'مشروبات باردة', 'وسط', 5),
('آيس لاتيه كبير', 17.00, '', 'مشروبات باردة', 'كبير', 6),
('آيس موكا وسط', 17.00, '', 'مشروبات باردة', 'وسط', 7),
('آيس موكا كبير', 19.00, '', 'مشروبات باردة', 'كبير', 8),
('آيس كراميل ماكياتو وسط', 18.00, '', 'مشروبات باردة', 'وسط', 9),
('آيس كراميل ماكياتو كبير', 20.00, '', 'مشروبات باردة', 'كبير', 10),
('آيس سبانيش لاتيه وسط', 19.00, '', 'مشروبات باردة', 'وسط', 11),
('آيس سبانيش لاتيه كبير', 21.00, '', 'مشروبات باردة', 'كبير', 12),
('ICE V60', 13.00, '', 'مشروبات باردة', 'وسط', 13),
('أيس ماتشا وسط', 16.00, '', 'مشروبات باردة', 'وسط', 15),
('أيس ماتشا كبير', 18.00, '', 'مشروبات باردة', 'كبير', 16),
('أيس TEA توت وسط', 14.00, '', 'مشروبات باردة', 'وسط', 17),
('أيس TEA توت كبير', 16.00, '', 'مشروبات باردة', 'كبير', 18),
('أيس TEA خوخ وسط', 14.00, '', 'مشروبات باردة', 'وسط', 19),
('أيس TEA خوخ كبير', 16.00, '', 'مشروبات باردة', 'كبير', 20),
('أيس بستاشيو وسط', 17.00, '', 'مشروبات باردة', 'وسط', 21),
('أيس بستاشيو كبير', 19.00, '', 'مشروبات باردة', 'كبير', 22),
('عصير فراولة وسط', 13.00, '', 'عصائر', 'وسط', 3),
('عصير فراولة كبير', 15.00, '', 'عصائر', 'كبير', 4),
('مهيتو ريدبول وسط', 18.00, '', 'مشروبات باردة', 'وسط', 25),
('مهيتو ريدبول كبير', 20.00, '', 'مشروبات باردة', 'كبير', 26),
('مهيتو كودرد وسط', 18.00, '', 'مشروبات باردة', 'وسط', 27),
('مهيتو كودرد كبير', 20.00, '', 'مشروبات باردة', 'كبير', 28),
('هوت شوكليت وسط', 14.00, '', 'مشروبات الشوكولاتة', 'وسط', 1),
('هوت شوكليت كبير', 16.00, '', 'مشروبات الشوكولاتة', 'كبير', 2),
('آيس شوكليت وسط', 15.00, '', 'مشروبات الشوكولاتة', 'وسط', 3),
('آيس شوكليت كبير', 17.00, '', 'مشروبات الشوكولاتة', 'كبير', 4),
('دارك شوكليت وسط', 16.00, '', 'مشروبات الشوكولاتة', 'وسط', 5),
('دارك شوكليت كبير', 18.00, '', 'مشروبات الشوكولاتة', 'كبير', 6),
('وايت شوكليت وسط', 16.00, '', 'مشروبات الشوكولاتة', 'وسط', 7),
('وايت شوكليت كبير', 18.00, '', 'مشروبات الشوكولاتة', 'كبير', 8),
('كرواسون زبدة', 15.00, '', 'المخبوزات', 'وسط', 1),
('كرواسون شوكولاتة', 16.00, '', 'المخبوزات', 'وسط', 2),
('كرواسون لوتس', 17.00, '', 'المخبوزات', 'وسط', 3),
('مافن فانيلا', 13.00, '', 'المخبوزات', 'وسط', 4),
('مافن شوكولاتة', 14.00, '', 'المخبوزات', 'وسط', 5),
('مافن توت', 14.00, '', 'المخبوزات', 'وسط', 6),
('كرواسون', 14.00, '', 'المخبوزات', 'وسط', 1),
('كعكة شوكولاتة', 18.00, '', 'حلويات', 'وسط', 2),
('تشيز كيك', 20.00, '', 'حلويات', 'وسط', 3),
('براونيز', 16.00, '', 'حلويات', 'وسط', 4),
('كوكيز', 12.00, '', 'حلويات', 'وسط', 5),
('تيراميسو', 19.00, '', 'حلويات', 'وسط', 6),
('بان كيك', 18.00, '', 'حلويات', 'وسط', 7),
('وافل', 17.00, '', 'حلويات', 'وسط', 8),
('دونات', 11.00, '', 'حلويات', 'وسط', 9);
