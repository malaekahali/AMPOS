<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงููุฏูุฑ - AM POS</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="icon" href="favicon.png" type="image/png">
    <script>
        // ูุญุต ุงูุฌูุณุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        window.addEventListener('load', function() {
            fetch('/api/auth/check', {
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    window.location.replace('/login.html');
                }
            })
            .catch(() => {
                window.location.replace('/login.html');
            });
        });

        // ููุน ุงูุชููู ุนุจุฑ ุฃุฒุฑุงุฑ ุงููุชุตูุญ
        window.addEventListener('beforeunload', function(e) {
            // ุฅุฒุงูุฉ ุงูุฌูุณุฉ ุนูุฏ ุฅุบูุงู ุงูุตูุญุฉ
            navigator.sendBeacon('/api/auth/logout');
        });

        // ููุน ุงูุชููู ุนุจุฑ ุฃุฒุฑุงุฑ ุงูุฎูู ูุงูุชุงูู
        window.addEventListener('popstate', function(e) {
            e.preventDefault();
            window.location.replace('/login.html');
        });

        // ููุน ุงูููุฑ ุจุฒุฑ ุงููุฃุฑุฉ ุงูุฃููู
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // ููุน ุงุฎุชุตุงุฑุงุช ููุญุฉ ุงูููุงุชูุญ
        document.addEventListener('keydown', function(e) {
            // ููุน Ctrl+U (ุนุฑุถ ุงููุตุฏุฑ)
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                return false;
            }
            // ููุน F12 (ุฃุฏูุงุช ุงููุทูุฑ)
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
            // ููุน Ctrl+Shift+I (ุฃุฏูุงุช ุงููุทูุฑ)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                return false;
            }
            // ููุน Ctrl+Shift+J (ูุญุฏุฉ ุงูุชุญูู)
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault();
                return false;
            }
            // ููุน Ctrl+Shift+C (ุฃุฏูุงุช ุงููุทูุฑ)
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                return false;
            }
            // ููุน ุฃุฒุฑุงุฑ ุงูุฎูู ูุงูุชุงูู
            if (e.key === 'Backspace' && !e.target.matches('input, textarea')) {
                e.preventDefault();
                return false;
            }
        });

        // ููุน ุงูุณุญุจ ูุงูุฅููุงุช
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
        });

        // ูุญุต ูุณุชูุฑ ููุฌูุณุฉ ูู 30 ุซุงููุฉ
        setInterval(function() {
            fetch('/api/auth/check', {
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    window.location.replace('/login.html');
                }
            })
            .catch(() => {
                window.location.replace('/login.html');
            });
        }, 30000);

        // ููุน ูุชุญ ุงูุฑูุงุจุท ูู ููุงูุฐ ุฌุฏูุฏุฉ
        document.addEventListener('click', function(e) {
            if (e.target.matches('a[target="_blank"]')) {
                e.preventDefault();
            }
        });

        // ุฅุนุงุฏุฉ ุชุนููู ุงูุชุงุฑูุฎ ุนูุฏ ุงูุชุฑููุฒ
        window.addEventListener('focus', function() {
            // ูุญุต ุงูุฌูุณุฉ ุนูุฏ ุงูุนูุฏุฉ ููุตูุญุฉ
            fetch('/api/auth/check', {
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    window.location.replace('/login.html');
                }
            })
            .catch(() => {
                window.location.replace('/login.html');
            });
        });
    </script>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <h2 class="app-name">AM POS</h2>
            </div>
            <div class="title-section">
                <h1>ููุญุฉ ุงููุฏูุฑ</h1>
            </div>
            <div class="user-info">
                <span id="userName"></span>
                <button id="themeToggleBtn" class="theme-toggle-btn btn" title="ุชุจุฏูู ุงููุถุน">๐</button>
                <button id="logoutBtn" class="logout-btn btn">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
            </div>
        </div>
    </header>

    <nav class="nav-tabs">
        <button class="tab-btn active" data-tab="products">ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</button>
        <button class="tab-btn" data-tab="employees">ุฅุฏุงุฑุฉ ุงูููุธููู</button>
        <button id="dailySalesBtn" class="daily-sales-btn btn" title="ุงููุจูุนุงุช ุงูููููุฉ">๐ ุงููุจูุนุงุช ุงูููููุฉ</button>
    </nav>

    <main class="main-content">
        <!-- ุชุจููุจ ุงูููุชุฌุงุช -->
        <div id="productsTab" class="tab-content active">
            <div class="section-header">
                <h2>ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</h2>
                <button id="addProductBtn" class="add-btn">ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</button>
            </div>

            <div class="products-container">
                <div class="products-accordion">
                    <button class="accordion-btn" id="productsAccordionBtn">
                        <span>ุงูููุชุฌุงุช</span>
                        <span class="accordion-icon">โผ</span>
                    </button>
                    <div class="accordion-content" id="productsAccordionContent">
                        <div class="products-grid" id="productsGrid">
                            <!-- ุณูุชู ุฅุถุงูุฉ ุงูููุชุฌุงุช ููุง ุฏููุงููููุงู -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ุชุจููุจ ุงูููุธููู -->
        <div id="employeesTab" class="tab-content">
            <div class="section-header">
                <h2>ุฅุฏุงุฑุฉ ุงูููุธููู</h2>
                <button id="addEmployeeBtn" class="add-btn">ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ</button>
            </div>

            <div class="employees-container">
                <div class="employees-accordion">
                    <button class="accordion-btn" id="employeesAccordionBtn">
                        <span>ุงูููุธููู</span>
                        <span class="accordion-icon">โผ</span>
                    </button>
                    <div class="accordion-content" id="employeesAccordionContent">
                        <div class="employees-list" id="employeesList">
                            <!-- ุณูุชู ุฅุถุงูุฉ ุงูููุธููู ููุง ุฏููุงููููุงู -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ููุฏุงู ุฅุถุงูุฉ/ุชุนุฏูู ุงูููุชุฌ -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</h3>
                <span class="close">&times;</span>
            </div>
            <form id="productForm">
                <div class="form-group">
                    <label for="productName">ุงุณู ุงูููุชุฌ</label>
                    <input type="text" id="productName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="productPrice">ุงูุณุนุฑ</label>
                    <input type="number" id="productPrice" name="price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="productImage">ุฑุงุจุท ุงูุตูุฑุฉ</label>
                    <input type="url" id="productImage" name="image_url">
                </div>
                <div class="form-group">
                    <label for="productCategory">ุงูุชุตููู</label>
                    <select id="productCategory" name="category" required>
                        <option value="ูุดุฑูุจุงุช ุณุงุฎูุฉ">ูุดุฑูุจุงุช ุณุงุฎูุฉ</option>
                        <option value="ูุดุฑูุจุงุช ุจุงุฑุฏุฉ">ูุดุฑูุจุงุช ุจุงุฑุฏุฉ</option>
                        <option value="ุนุตุงุฆุฑ">ุนุตุงุฆุฑ</option>
                        <option value="ูุดุฑูุจุงุช ุงูุดููููุงุชุฉ">ูุดุฑูุจุงุช ุงูุดููููุงุชุฉ</option>
                        <option value="ุงููุฎุจูุฒุงุช">ุงููุฎุจูุฒุงุช</option>
                        <option value="ุญูููุงุช">ุญูููุงุช</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn">ุฅูุบุงุก</button>
                    <button type="submit" class="save-btn">ุญูุธ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ููุฏุงู ุฅุถุงูุฉ/ุชุนุฏูู ุงูููุธู -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employeeModalTitle">ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ</h3>
                <span class="close">&times;</span>
            </div>
            <form id="employeeForm">
                <div class="form-group">
                    <label for="employeeName">ุงุณู ุงูููุธู</label>
                    <input type="text" id="employeeName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="employeeNumber">ุฑูู ุงูููุธู</label>
                    <input type="text" id="employeeNumber" name="employee_number" required>
                </div>
                <div class="form-group">
                    <label for="employeePassword">ูููุฉ ุงููุฑูุฑ</label>
                    <input type="password" id="employeePassword" name="password" required>
                </div>
                <div class="form-group">
                    <label for="employeeRole">ุงูุฏูุฑ</label>
                    <select id="employeeRole" name="role" required>
                        <option value="cashier">ูุงุดูุฑ</option>
                        <option value="admin">ูุฏูุฑ</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn">ุฅูุบุงุก</button>
                    <button type="submit" class="save-btn">ุญูุธ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ููุฏุงู ุงูุชุฃููุฏ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h3>ุชุฃููุฏ ุงูุญุฐู</h3>
                <span class="close">&times;</span>
            </div>
            <p>ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุนูุตุฑุ</p>
            <div class="modal-actions">
                <button type="button" class="cancel-btn">ุฅูุบุงุก</button>
                <button type="button" id="confirmDeleteBtn" class="delete-btn">ุญุฐู</button>
            </div>
        </div>
    </div>

    <!-- ููุฏุงู ุงููุจูุนุงุช ุงูููููุฉ -->
    <div id="dailySalesModal" class="modal">
        <div class="modal-content daily-sales-modal">
            <div class="modal-header">
                <h3>ุงููุจูุนุงุช ุงูููููุฉ</h3>
                <span class="close" id="closeDailySalesModal">&times;</span>
            </div>
            <div id="dailySalesContent">
                <!-- ุณูุชู ุชุญููู ูุญุชูู ุงููุจูุนุงุช ุงูููููุฉ ููุง -->
            </div>
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
    </div>

    <script src="js/admin.js"></script>
</body>
</html>
