<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุทุฉ ุงูุจูุน - AM POS</title>
    <link rel="stylesheet" href="css/cashier.css">
    <link rel="icon" href="favicon.png" type="image/png">
    <script>
        // ูุญุต ุงูุฌูุณุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        window.addEventListener('load', function() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.replace('/login.html');
                return;
            }

            fetch('/api/auth/check', {
                method: 'GET',
                headers: {
                    'x-access-token': token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('user');
                    window.location.replace('/login.html');
                } else {
                    // ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู
                    localStorage.setItem('user', JSON.stringify(data.user));
                    document.getElementById('userName').textContent = data.user.name;
                }
            })
            .catch(() => {
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                window.location.replace('/login.html');
            });
        });

        // ููุน ุงูุชููู ุนุจุฑ ุฃุฒุฑุงุฑ ุงููุชุตูุญ
        window.addEventListener('beforeunload', function(e) {
            // ุฅุฒุงูุฉ ุงูุฌูุณุฉ ุนูุฏ ุฅุบูุงู ุงูุตูุญุฉ
            navigator.sendBeacon('/api/auth/logout');
        });

        // ููุน ุงูุชููู ุนุจุฑ ุฃุฒุฑุงุฑ ุงูุฎูู ูุงูุชุงูู
        window.addEventListener('popstate', function(e) {
            e.preventDefault();
            window.location.replace('/login.html');
        });

        // ููุน ุงูููุฑ ุจุฒุฑ ุงููุฃุฑุฉ ุงูุฃููู
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // ููุน ุงุฎุชุตุงุฑุงุช ููุญุฉ ุงูููุงุชูุญ
        document.addEventListener('keydown', function(e) {
            // ููุน Ctrl+U (ุนุฑุถ ุงููุตุฏุฑ)
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                return false;
            }
            // ููุน F12 (ุฃุฏูุงุช ุงููุทูุฑ)
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
            // ููุน Ctrl+Shift+I (ุฃุฏูุงุช ุงููุทูุฑ)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                return false;
            }
            // ููุน Ctrl+Shift+J (ูุญุฏุฉ ุงูุชุญูู)
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault();
                return false;
            }
            // ููุน Ctrl+Shift+C (ุฃุฏูุงุช ุงููุทูุฑ)
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                return false;
            }
            // ููุน ุฃุฒุฑุงุฑ ุงูุฎูู ูุงูุชุงูู
            if (e.key === 'Backspace' && !e.target.matches('input, textarea')) {
                e.preventDefault();
                return false;
            }
        });

        // ููุน ุงูุณุญุจ ูุงูุฅููุงุช
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
        });

        // ูุญุต ูุณุชูุฑ ููุฌูุณุฉ ูู 30 ุซุงููุฉ
        setInterval(function() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.replace('/login.html');
                return;
            }

            fetch('/api/auth/check', {
                method: 'GET',
                headers: {
                    'x-access-token': token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('user');
                    window.location.replace('/login.html');
                }
            })
            .catch(() => {
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                window.location.replace('/login.html');
            });
        }, 30000);

        // ููุน ูุชุญ ุงูุฑูุงุจุท ูู ููุงูุฐ ุฌุฏูุฏุฉ
        document.addEventListener('click', function(e) {
            if (e.target.matches('a[target="_blank"]')) {
                e.preventDefault();
            }
        });

        // ุฅุนุงุฏุฉ ุชุนููู ุงูุชุงุฑูุฎ ุนูุฏ ุงูุชุฑููุฒ
        window.addEventListener('focus', function() {
            // ูุญุต ุงูุฌูุณุฉ ุนูุฏ ุงูุนูุฏุฉ ููุตูุญุฉ
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.replace('/login.html');
                return;
            }

            fetch('/api/auth/check', {
                method: 'GET',
                headers: {
                    'x-access-token': token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('user');
                    window.location.replace('/login.html');
                }
            })
            .catch(() => {
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                window.location.replace('/login.html');
            });
        });
    </script>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <h2 class="app-name">AM POS</h2>
            </div>
            <div class="title-section">
                <h1>ููุทุฉ ุงูุจูุน</h1>
            </div>
            <div class="user-info">
                <span id="userName"></span>
                <button id="themeToggleBtn" class="theme-toggle-btn btn" title="ุชุจุฏูู ุงููุถุน">๐</button>
                <button id="logoutBtn" class="logout-btn btn">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- ูุงุฆูุฉ ุงูููุชุฌุงุช -->
        <div class="products-section">
            <div class="section-header">
                <h2>ุงูููุชุฌุงุช</h2>
                <div class="category-filter">
                    <button class="category-btn active" data-category="all">ุงููู</button>
                    <button class="category-btn" data-category="ูุดุฑูุจุงุช ุณุงุฎูุฉ">ูุดุฑูุจุงุช ุณุงุฎูุฉ</button>
                    <button class="category-btn" data-category="ูุดุฑูุจุงุช ุจุงุฑุฏุฉ">ูุดุฑูุจุงุช ุจุงุฑุฏุฉ</button>
                    <button class="category-btn" data-category="ุนุตุงุฆุฑ">ุนุตุงุฆุฑ</button>
                    <button class="category-btn" data-category="ูุดุฑูุจุงุช ุงูุดููููุงุชุฉ">ูุดุฑูุจุงุช ุงูุดููููุงุชุฉ</button>
                    <button class="category-btn" data-category="ุงููุฎุจูุฒุงุช">ุงููุฎุจูุฒุงุช</button>
                    <button class="category-btn" data-category="ุญูููุงุช">ุญูููุงุช</button>
                </div>
            </div>

            <div class="products-grid" id="productsGrid">
                <!-- ุณูุชู ุฅุถุงูุฉ ุงูููุชุฌุงุช ููุง ุฏููุงููููุงู -->
            </div>
        </div>

        <!-- ุณูุฉ ุงููุดุชุฑูุงุช -->
        <div class="cart-section">
            <div class="section-header">
                <h2>ุณูุฉ ุงููุดุชุฑูุงุช</h2>
                <button id="clearCartBtn" class="clear-btn">ูุณุญ ุงููู</button>
            </div>

            <div class="cart-items" id="cartItems">
                <div class="empty-cart">
                    <span>๐</span>
                    <p>ุงูุณูุฉ ูุงุฑุบุฉ</p>
                </div>
            </div>

            <div class="cart-total">
                <div class="total-row">
                    <span>ุงููุฌููุน:</span>
                    <span id="totalAmount">0.00 ุฑูุงู</span>
                </div>
            </div>

            <div class="action-section">
                <button id="checkoutBtn" class="checkout-btn" disabled>ุฅุชูุงู ุงูุดุฑุงุก</button>
                <button id="dailySalesBtn" class="daily-sales-btn btn" title="ุงููุจูุนุงุช ุงูููููุฉ">๐ ุงููุจูุนุงุช ุงูููููุฉ</button>
            </div>
        </div>
    </div>



    <!-- ููุฏุงู ุงูุฏูุน -->
    <div id="paymentModal" class="modal">
        <div class="modal-content payment-modal">
            <div class="modal-header">
                <h3>ุงูุฏูุน</h3>
                <span class="close" id="closePaymentModal">&times;</span>
            </div>
            <div id="paymentContent">
                <!-- ุณูุชู ุชุญููู ูุญุชูู ุงูุฏูุน ููุง -->
            </div>
        </div>
    </div>

    <!-- ููุฏุงู ุงูุฅูุตุงู -->
    <div id="receiptModal" class="modal">
        <div class="modal-content receipt">
            <div class="modal-header">
                <h3>ุงูุฅูุตุงู</h3>
                <span class="close">&times;</span>
            </div>

            <div class="receipt-content" id="receiptContent">
                <!-- ุณูุชู ุฅุถุงูุฉ ูุญุชูู ุงูุฅูุตุงู ููุง -->
            </div>

            <div class="modal-actions">
                <button type="button" id="printReceiptBtn" class="print-btn">ุทุจุงุนุฉ</button>
                <button type="button" id="newSaleBtn" class="new-sale-btn">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>

    <!-- ููุฏุงู ุงููุจูุนุงุช ุงูููููุฉ -->
    <div id="dailySalesModal" class="modal">
        <div class="modal-content daily-sales-modal">
            <div class="modal-header">
                <h3>ุงููุจูุนุงุช ุงูููููุฉ</h3>
                <span class="close" id="closeDailySalesModal">&times;</span>
            </div>
            <div id="dailySalesContent">
                <!-- ุณูุชู ุชุญููู ูุญุชูู ุงููุจูุนุงุช ุงูููููุฉ ููุง -->
            </div>
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
    </div>

    <script src="js/cashier.js"></script>
</body>
</html>
